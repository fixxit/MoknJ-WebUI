"use strict";angular.module("User").factory("UserService",["SettingsCall","MenuService",function(SettingsCall,MenuService){var service={};return service.getAllMenus=function(token,callback){MenuService.getAllMenus(token,callback)},service.allRights=function(token,callback){SettingsCall.process("resource/all/rights?access_token="+token,null,callback)},service.get=function(token,id,callback){SettingsCall.process("resource/get/"+id+"?access_token="+token,null,callback)},service.save=function(token,data,callback){SettingsCall.process("resource/add/?access_token="+token,data,callback)},service.authorities=function(token,callback){SettingsCall.process("resource/authorities?access_token="+token,null,callback)},service.all=function(token,callback){SettingsCall.process("resource/get/all/?access_token="+token,null,callback)},service.remove=function(token,id,callback){SettingsCall.process("resource/delete/"+id+"?access_token="+token,null,callback)},service}]),angular.module("User").controller("UserController",["$scope","$rootScope","$location","UserService","$modal",function($scope,$rootScope,$location,UserService,$modal){$scope.menuId=$location.search().menuId?$location.search().menuId:null,$scope.isCollapsed=!1,$scope.containerCollapsed=!1,$scope.resourceId=$location.search().resourceId,$scope.resource={},$scope.pagination={},$scope.resourceId&&($scope.resource.id=$scope.resourceId),$scope.loadPage=function(id){$scope.loading=!0,id&&$scope.editResource(id),$scope.getAuthorities(),$scope.getMenus(),$scope.getRights(),UserService.all($rootScope.globals.currentUser.access_token,function(response){response?response.error_description?"Access is denied"!==response.error_description&&($scope.error=response.error_description+". Please logout!"):response.resources?($scope.resources=response.resources,$scope.pagination.viewby=10,$scope.pagination.totalItems=response.resources.length,$scope.pagination.currentPage=1,$scope.pagination.itemsPerPage=10,$scope.pagination.maxSize=10):$scope.error="Invalid server response":$scope.error="Invalid server response",$scope.loading=!1})},$scope.save=function(){$scope.dataLoading=!0,$scope.resource.authorities=[],angular.forEach($scope.authorities,function(auth){auth.value&&$scope.resource.authorities.push(auth.name)}),$scope.resource.systemUser||($scope.resource.userName=null,$scope.resource.password=null,$scope.resource.authorities=[]),UserService.save($rootScope.globals.currentUser.access_token,$scope.resource,function(response){response.error_description?($scope.success=null,"Access is denied"!==response.error_description?$scope.error=response.error_description+". Please logout!":$scope.error=response.error_description+". Please contact your administrator."):response.success===!0?($scope.resourceId?$scope.success="Successfully update employee":$scope.success="Successfully saved a new employee",$scope.loadPage(),$scope.reset(),$scope.resourceId=null):($scope.success=null,$scope.error=response.message),$scope.dataLoading=!1})},$scope.addAllRights=function(enumName){},$scope.addAllRightForMenu=function(menu,enumName){},$scope.addRightForTemplate=function(menu,template,enumName){},$scope.isEven=function(value){return value%2===0?"":"active"},$scope.isSystemUser=function(value){return value?"glyphicon glyphicon-ok":"glyphicon glyphicon-remove"},$scope.isCollapsedClass=function(newCollapse){return newCollapse?"glyphicon glyphicon-collapse-up":"glyphicon glyphicon-expand"},$scope.reset=function(messages){$scope.resource={},messages&&($scope.success=null,$scope.error=null),angular.forEach($scope.authorities,function(auth){auth.value=!1})},$scope.cancel=function(){$scope.resourceId=null,$scope.reset(),$scope.success=null,$scope.error=null},$scope.deletResource=function(resource,callback){UserService.remove($rootScope.globals.currentUser.access_token,resource.id,function(response){response.error_description?callback(!1,response.error_description):callback(!0)})},$scope.editResource=function(id){$scope.resourceId=id,UserService.get($rootScope.globals.currentUser.access_token,id,function(response){response.error_description?($scope.success=null,$scope.error=response.error_description):($scope.resource=response.resource,angular.forEach($scope.authorities,function(auth){var value=!1;angular.forEach($scope.resource.authorities,function(resAuth){resAuth===auth.name&&(value=!0)}),auth.value=value}),$scope.newCollapse=!0)})},$scope.getMenus=function(){UserService.getAllMenus($rootScope.globals.currentUser.access_token,function(response){response.error_description?($scope.success=null,"Access is denied"!==response.error_description&&($scope.error=response.error_description)):response.menus&&($scope.menus=response.menus)})},$scope.getRights=function(){UserService.allRights($rootScope.globals.currentUser.access_token,function(response){response.error_description?($scope.success=null,"Access is denied"!==response.error_description&&($scope.error=response.error_description)):response.rights&&($scope.rights=response.rights)})},$scope.getAuthorities=function(){UserService.authorities($rootScope.globals.currentUser.access_token,function(response){response.error_description?($scope.success=null,"Access is denied"!==response.error_description&&($scope.error=response.error_description)):response.authorities&&($scope.authorities=[],angular.forEach(response.authorities,function(auth){auth&&$scope.authorities.push({name:auth,value:{}})}))})},$scope.removeResource=function(resource){$modal.open({backdrop:!0,templateUrl:"../modules/user/templates/deleteuser.html",controller:"ModalDeleteResourceCtrl",resolve:{parentScope:function(){return $scope},resource:function(){return resource}}})},$scope.removeFromList=function(resource){var index=$scope.resources.indexOf(resource);$scope.resources.splice(index,1)},$scope.loadPage($scope.resourceId)}]),angular.module("User").controller("ModalDeleteResourceCtrl",function($scope,$modalInstance,parentScope,resource){$scope.name=resource.firstName+" "+resource.surname,$scope.accept=!1,$scope.errorMessage=!1,$scope.message="",$scope.ok=function(){$scope.errorMessage=!1,$scope.dataLoading=!0,parentScope.deletResource(resource,function(success,message){success?(parentScope.removeFromList(resource),$modalInstance.close()):($scope.errorMessage=!0,$scope.message=message)})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),angular.module("User").filter("filterMultiple",["$filter",function($filter){return function(items,values,pagination){if(values&&Array===values.constructor){var results=items;angular.forEach(values,function(value){value&&items&&Array===items.constructor&&(results=$filter("filter")(results,value))}),items&&Array===items.constructor&&values&&Array===values.constructor&&(pagination.searchSize=results.length,items=results.slice((pagination.currentPage-1)*pagination.itemsPerPage,pagination.currentPage*pagination.itemsPerPage))}return items}}]);